
   
DOMAIN, FIELD, TYPE, ELEMENT, ATTRIBUTE, FUNCTION, ARGUMENT_NAMES 
PERSON, root,  ROOT, "./recordTarget/patientRole", ,,
PERSON, person_other_id, FIELD, 'id[@root="2.16.840.1.113883.4.6"]', "extension", ,
PERSON, person_id, PK, 'id[@root="2.16.840.1.113883.4.1"]', "extension", ,
PERSON, gender_concept_code, FIELD, patient/administrativeGenderCode, code, ,
PERSON, gender_concept_codeSystem, FIELD, patient/administrativeGenderCode, codeSystem, ,
PERSON, gender_concept_code_id, DERIVED, , , 'concept_code' : 'gender_concept_code'| 'vocabulary_oid' : 'gender_concept_codeSystem'
PERSON, race_concept_code, FIELD, patient/raceCode, code, ,
PERSON, race_concept_codeSystem, FIELD, patient/raceCode, codeSystem, ,
PERSON, race_concept_code_id, DERIVED, , , 'concept_code' : 'race_concept_code'| 'vocabulary_oid' : 'race_concept_codeSystem'
PERSON, ethnicity_concept_code, FIELD, patient/ethnicityCode, code, ,
PERSON, ethnicity_concept_codeSystem, FIELD, patient/ethnicityCode, codeSystem, ,
PERSON, ethnicity_concept_code_id, DERIVED, , , 'concept_code' : 'gender_concept_code'| 'vocabulary_oid' : 'gender_concept_codeSystem'

 'person': { 
        # person nor patientRole have templateIDs
        'root' : { # name is required to be root, see foolish consistency below
            'type' : 'ROOT', # (really a foolish consistency, not used here)
            'element': "./recordTarget/patientRole"
        }, 
        'person_other_id' : {
            'type' : 'FIELD',
            'element' : 'id[@root="2.16.840.1.113883.4.6"]',
            'attribute' : "extension"
        },
        'person_id' : {
            'type' : 'PK',
            'element' : 'id[@root="2.16.840.1.113883.4.1"]',
            'attribute' : "extension"
        },
        'gender_concept_code' : { 
            'type' : 'FIELD',
            'element' : "patient/administrativeGenderCode", 
            'attribute' : "code"
        },
        'gender_concept_codeSystem' : { 
            'type' : 'FIELD',
            'element' : "patient/administrativeGenderCode", 
            'attribute' : "codeSystem"
        },
        'gender_concept_id' : {
            'type' : 'DERIVED',
            'FUNCTION' : VT.map_hl7_to_omop_w_dict_args, 
            'argument_names' : { 
                'concept_code' : 'gender_concept_code', 
                'vocabulary_oid' : 'gender_concept_codeSystem'
            }
        },
        'date_of_birth': { 
            'type' : 'FIELD',
            'element' : "patient/birthTime", 
            'attribute' : "value" 
        },
        'race_concept_code' : { 
            'type' : 'FIELD',
            'element' : "patient/raceCode", 
            'attribute' : "code"
        },
        'race_concept_codeSystem' : { 
            'type' : 'FIELD',
            'element' : "patient/raceCode", 
            'attribute' : "codeSystem"
        },
        'race_concept_id':{
            'type' : 'DERIVED',
            'FUNCTION' : VT.map_hl7_to_omop_w_dict_args,
            'argument_names' : { 
                'concept_code' : 'race_concept_code', 
                'vocabulary_oid' : 'race_concept_codeSystem'
            }
        },
        'ethnicity_concept_code' : {
            'type' : 'FIELD',
            'element' : "patient/ethnicGroupCode", 
            'attribute': "code"
        },
        'ethnicity_concept_codeSystem' : {
            'type' : 'FIELD',
            'element' : "patient/ethnicGroupCode", 
            'attribute': "codeSystem"
        },
        'ethnicity_concept_id' : {
            'type' : 'DERIVED',
            'FUNCTION' : VT.map_hl7_to_omop_w_dict_args, # not the string representing the name, but function itself in Python space.
            'argument_names' : { 
                'concept_code' : 'ethnicity_concept_code', 
                'vocabulary_oid' : 'ethnicity_concept_codeSystem'
            }
        },
    },

DOMAIN, FIELD, TYPE, ELEMENT, ATTRIBUTE, FUNCTION, ARGUMENT_NAMES 
encounter, root, ROOT
encounter, person_id, FK
encounter, visit_occurrence_id, PK
encounter, visit_concept_code, FIELD, code, code
encounter, visit_concept_codeSystem, FIELD, code, codeSystem
encounter, visit_concept_id, DERIVED,,, 'concept_code' : 'visit_concept_code' | 'vocabulary_oid' : 'visit_concept_codeSystem' 
    'encounter' : {
        # FIX: there's a code for what might be admitting diagnosis here 
        'root': {
            'type' : 'ROOT',
            'element' : "./componentOf/encompassingEncounter"
        }, 
        'person_id' : { 
            'type' : 'FK',
            'FK' : 'person_id' 
        },
        'visit_occurrence_id' : {  
            # FIX: why would an occurence_id be an NPI????!!!!!!!
            'type' : 'PK',
            'element' : 'id[@root="2.16.840.1.113883.4.6"]',
                # The root says "NPI". The extension is the actual NPI
            'attribute': "extension",
        },
        'visit_concept_code' : { 
            'type' : 'FIELD',
            'element' : "code",   # FIX ToDo is this what I think it is?,
            'attribute' : "code"
        }, 
        'visit_concept_codeSystem' : { 
            'type' : 'FIELD',
            'element' : "code",
            'attribute' : "codeSystem"
        }, 
        'visit_concept_id' : {
            'type' : 'DERIVED',
            'FUNCTION' : VT.map_hl7_to_omop_w_dict_args, # not the string representing the name, but function itself in Python space.
            'argument_names' : { 
                'concept_code' : 'visit_concept_code', 
                'vocabulary_oid' : 'visit_concept_codeSystem'
            }
        },
        'care_site_id' : { 
            'type' : 'FIELD',
            'element' : "location/healthCareFacility/id",
            'attribute' : "root"
        },
        'provider_id_field' : { 
            'type' : 'FK',
            'FK' : 'provider_id'
        },
        'provider_id_field' : { 
            'type' : 'FIELD',
            'element' : "responsibleParty/assignedEntity/id",
            'attribute' : "root"
        },
        # leaving these here more for testing how to pull #text
        'provider_prefix' : { 
            'type' : 'FIELD',
            'element' : "responsibleParty/assignedEntity/assignedPerson/name/prefix",
            'attribute' : "#text"
        },
        'provider_given' : { 
            'type' : 'FIELD',
            'element' : "responsibleParty/assignedEntity/assignedPerson/name/given",
            'attribute' : "#text"
        },
        'provider_family' : { 
            'type' : 'FIELD',
            'element' : "responsibleParty/assignedEntity/assignedPerson/name/family",
            'attribute' : "#text"
        },
        # FIX is it consistenly a high/low pair? do we sometimes get just effectiveTime@value ?
        'start_time' : { 
            'type' : 'FIELD',
            'element' : "effectiveTime/low",
            'attribute' : "value"
        },
        'end_time' :  { 
            'type' : 'FIELD',
            'element' : "effectiveTime/high",
            'attribute' : "value"
        }
    },

DOMAIN, FIELD, TYPE, ELEMENT, ATTRIBUTE, FUNCTION, ARGUMENT_NAMES 
    'observation' : {
        'root' : {
            'type' : 'ROOT',
            'element': 
                  ("./component/structuredBody/component/section/"
                   "templateId[@root='2.16.840.1.113883.10.20.22.2.3.1']"
                   "/../entry/organizer/component/observation")
                    # FIX: another template at the observation level here: "2.16.840.1.113883.10.20.22.4.2
                 },
        'person_id' : { 
            'type' : 'FK', 
            'FK' : 'person_id' 
        }, 
        'visit_occurrence_id' :  { 
            'type' : 'FK', 
            'FK' : 'visit_occurrence_id' 
        }, 
        'observation_id' : {  # FIX, these IDs come up the same for all 3 observations in the CCD Ambulatory doc.
            'type' : 'FIELD',
            'element' : 'id',
            'attribute' : 'root'   ### FIX ????
        },
        'observation_concept_code' : {
            'type' : 'FIELD',
            'element' : "code" ,
            'attribute' : "code"
        },
        'observation_concept_codeSystem' : {
            'type' : 'FIELD',
            'element' : "code",
            'attribute' : "codeSystem"
        },
        'observation_concept_id' : {
            'type' : 'DERIVED', 
            'FUNCTION' : VT.map_hl7_to_omop_w_dict_args, # not the string representing the name, but function itself in Python space.
            'argument_names' : { 
                'concept_code' : 'observation_concept_code', 
                'vocabulary_oid' : 'observation_concept_codeSystem'
            }
        },
        'observation_concept_displayName' : {
            'type' : 'FIELD',
            'element' : "code",
            'attribute' : "displayName"
        },
        # FIX same issue as above. Is it always just a single value, or do we ever get high and low?
        'time' : {
            'type' : 'FIELD',
            'element' : "effectiveTime",
            'attribute' : "value"
        },
        'value' : { 
            'type' : 'FIELD',
            'element' : "value" ,
            'attribute' : "value"
        },
        'value_type' : { 
            'type' : 'FIELD',
            'element' : "value",
            'attribute' : "type"
        },
        'value_unit' :  { 
            'type' : 'FIELD',
            'element' : 'value',
            'attribute' : 'unit'
        }
    }
}

def get_meta_dict():
    return meta_dict
